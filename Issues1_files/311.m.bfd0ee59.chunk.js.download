(window.webpackJsonp=window.webpackJsonp||[]).push([[311],{1697:function(e,t,a){var n=a(313),r=a(1698);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i={insert:"head",singleton:!1},o=(n(r,i),r.locals?r.locals:{});e.exports=o},1698:function(e,t,a){(t=a(314)(!1)).push([e.i,".manual-project-create{max-width:700px}.manual-project-create .button{margin-top:8px}",""]),e.exports=t},1699:function(e,t,a){var n=a(313),r=a(1700);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i={insert:"head",singleton:!1},o=(n(r,i),r.locals?r.locals:{});e.exports=o},1700:function(e,t,a){(t=a(314)(!1)).push([e.i,"#create-project{padding-top:0!important}#create-project header{padding-top:20px;background-color:#f3f3f3;position:-webkit-sticky;position:sticky;top:48px;z-index:50}.create-project-manual{display:flex!important;justify-content:space-between}.create-project-azdo-repo{width:410px;min-height:40px;box-sizing:border-box;margin-right:auto}.create-project-import-bbs .open .boxed-group-header{border-bottom:1px solid #e6e6e6}.create-project-import-bbs .boxed-group-inner{padding-top:24px}.create-project-import-bbs-repo{width:250px;min-height:40px}.create-project-github-repository{box-sizing:border-box;width:33.33%}.create-project-github-repository .notice{display:block;position:absolute}.create-project-github-repository .notice svg{color:#0a0}.create-project-import-gitlab table>tbody>tr>td{vertical-align:middle}.create-project-import-gitlab .project-name,.create-project-import-gitlab .project-path{max-width:400px}.create-project-import-gitlab .sq-project-link{max-width:300px}.create-project-import-gitlab .already-set-up svg{color:#0a0}",""]),e.exports=t},1849:function(e,t,a){"use strict";a.r(t),a.d(t,"CreateProjectPage",(function(){return Ke}));var n=a(2),r=a(334),i=a(31),o=a(511),s=a(360),c=a(721),l=a(514),p=a(321),d=a(379),m=a(378),g=a.n(m),u=a(9),h=a(323);function b(e,t){return Object(u.post)("/api/alm_integrations/set_pat",{almSetting:e,pat:t}).catch(h.a)}function j(e){return Object(u.get)("/api/alm_integrations/check_pat",{almSetting:e}).then(()=>!0).catch(e=>400!==e.status&&Object(h.a)(e))}var y=a(312),_=a(350),f=a.n(_),k=a(316),E=a.n(k),v=a(341),S=a(311),O=a(319),N=a(538),P=a.n(N),R=a(397),w=a.n(R);function A(e){return"".concat(e.replace(/\/$/,""),"/_usersSettings/tokens")}function x(e){const{almSetting:{alm:t,url:a},submitting:r=!1,validationFailed:o}=e,[s,c]=n.useState(!1);n.useEffect(()=>{c(!1)},[r]);const[l,p]=n.useState(""),d=o&&!s||s&&!l;let m;return l?d&&(m=Object(i.translate)("onboarding.create_project.pat_incorrect",t)):m=Object(i.translate)("onboarding.create_project.pat_form.pat_required"),n.createElement("div",{className:"boxed-group abs-width-600"},n.createElement("div",{className:"boxed-group-inner"},n.createElement("h2",null,Object(i.translate)("onboarding.create_project.pat_form.title",t)),n.createElement("div",{className:"big-spacer-top big-spacer-bottom"},n.createElement(O.FormattedMessage,{id:"onboarding.create_project.pat_help.instructions",defaultMessage:Object(i.translate)("onboarding.create_project.pat_help.instructions",t),values:{link:a?n.createElement("a",{className:"link-with-icon",href:A(a),rel:"noopener noreferrer",target:"_blank"},n.createElement(w.a,{className:"little-spacer-right"}),n.createElement("span",null,Object(i.translate)("onboarding.create_project.pat_help.instructions.link",t))):Object(i.translate)("onboarding.create_project.pat_help.instructions.link",t),scope:n.createElement("strong",null,n.createElement("em",null,"Code (Read & Write)"))}})),n.createElement("form",{onSubmit:t=>{t.preventDefault(),e.onPersonalAccessTokenCreate(l)}},n.createElement(P.a,{error:m,id:"personal_access_token",isInvalid:d,isValid:!1,label:Object(i.translate)("onboarding.create_project.enter_pat"),required:!0},n.createElement("input",{autoFocus:!0,className:S("width-100 little-spacer-bottom",{"is-invalid":d}),id:"personal_access_token",minLength:1,name:"personal_access_token",onChange:e=>{p(e.target.value),c(!0)},type:"text",value:l})),n.createElement(y.SubmitButton,{disabled:d||r||!s},Object(i.translate)("onboarding.create_project.pat_form.list_repositories")),n.createElement(E.a,{className:"spacer-left",loading:r}))))}var z,C=a(318),F=a(346),M=a.n(F),I=a(322),T=a(590),L=a.n(T),B=a(383),K=a.n(B),q=a(510),D=a.n(q),V=a(345);!function(e){e.Manual="manual",e.AzureDevOps="azure",e.BitbucketServer="bitbucket",e.GitHub="github",e.GitLab="gitlab"}(z||(z={}));function G(e,t,a=!1){if(!t||!e.toLowerCase().includes(t.toLowerCase()))return e;const[r,i,o]=e.split(new RegExp("(".concat(t,")(.*)"),"i"));return n.createElement(n.Fragment,null,r,n.createElement("strong",{className:S({underline:a})},i),o)}function Q(e){const{importing:t,loading:a,startsOpen:r,project:o,repositories:s=[],searchQuery:c,selectedRepository:l}=e,[d,m]=n.useState(r),[g,u]=n.useState(1),h=s.slice(0,30*g),b=e=>(null==l?void 0:l.projectName)===o.name&&l.name===e.name;return n.createElement(L.a,{className:S("big-spacer-bottom",{open:d}),onClick:()=>{d||e.onOpen(o.name),m(!d)},open:d,title:n.createElement("h3",{title:o.description},G(o.name,c,!0))},d&&n.createElement(E.a,{loading:a},a||0!==s.length?n.createElement(n.Fragment,null,n.createElement("div",{className:"display-flex-wrap"},h.map(a=>n.createElement("div",{className:"create-project-azdo-repo display-flex-start spacer-bottom padded-right",key:a.name},a.sqProjectKey?n.createElement(n.Fragment,null,n.createElement(D.a,{className:"spacer-right",fill:V.colors.green,size:14}),n.createElement("div",{className:"overflow-hidden"},n.createElement("div",{className:"little-spacer-bottom text-ellipsis"},n.createElement(C.Link,{to:Object(p.v)(a.sqProjectKey),title:a.sqProjectName},G(a.sqProjectName||a.name,c))),n.createElement("em",null,Object(i.translate)("onboarding.create_project.repository_imported")))):n.createElement(K.a,{checked:b(a),className:"overflow-hidden",disabled:t,onCheck:()=>e.onSelectRepository(a),value:a.name},n.createElement("span",{className:"text-ellipsis",title:a.name},G(a.name,c)))))),n.createElement(M.a,{count:h.length,total:s.length,loadMore:()=>u(e=>e+1)})):n.createElement(I.Alert,{variant:"warning"},n.createElement(O.FormattedMessage,{defaultMessage:Object(i.translate)("onboarding.create_project.azure.no_repositories"),id:"onboarding.create_project.azure.no_repositories",values:{link:n.createElement(C.Link,{to:{pathname:"/projects/create",query:{mode:z.AzureDevOps,resetPat:1}}},Object(i.translate)("onboarding.create_project.update_your_token"))}}))))}function U(e){const{importing:t,loadingRepositories:a,projects:r=[],repositories:o,searchResults:s,searchQuery:c,selectedRepository:l}=e,[p,d]=n.useState(1),m=s?r.filter(e=>void 0!==s[e.name]):r;if(0===m.length)return n.createElement(I.Alert,{className:"spacer-top",variant:"warning"},s?Object(i.translate)("onboarding.create_project.azure.no_results"):n.createElement(O.FormattedMessage,{defaultMessage:Object(i.translate)("onboarding.create_project.azure.no_projects"),id:"onboarding.create_project.azure.no_projects",values:{link:n.createElement(C.Link,{to:{pathname:"/projects/create",query:{mode:z.AzureDevOps,resetPat:1}}},Object(i.translate)("onboarding.create_project.update_your_token"))}}));const g=m.slice(0,10*p),u=s?" - result":"";return n.createElement("div",null,g.map((r,i)=>n.createElement(Q,{key:"".concat(r.name).concat(u),importing:t,loading:Boolean(a[r.name]),onOpen:e.onOpenProject,onSelectRepository:e.onSelectRepository,project:r,repositories:s?s[r.name]:o[r.name],selectedRepository:l,searchQuery:c,startsOpen:void 0!==s||0===i})),n.createElement(M.a,{count:g.length,loadMore:()=>d(e=>e+1),total:m.length}))}function J(e){const{additionalActions:t,title:a}=e;return n.createElement("header",{className:"huge-spacer-bottom bordered-bottom overflow-hidden"},n.createElement("h1",{className:"pull-left huge big-spacer-bottom"},a),t)}var W=a(641);function H(e){const{alm:t,canAdmin:a}=e;return n.createElement(I.Alert,{variant:"error"},a?n.createElement(O.FormattedMessage,{defaultMessage:Object(i.translate)("onboarding.create_project.wrong_binding_count.admin"),id:"onboarding.create_project.wrong_binding_count.admin",values:{alm:Object(i.translate)("onboarding.alm",t),url:n.createElement(C.Link,{to:{pathname:"/admin/settings",query:{category:W.a}}},Object(i.translate)("settings.page"))}}):n.createElement(O.FormattedMessage,{defaultMessage:Object(i.translate)("onboarding.create_project.wrong_binding_count"),id:"onboarding.create_project.wrong_binding_count",values:{alm:Object(i.translate)("onboarding.alm",t)}}))}function $(e){const{canAdmin:t,importing:a,loading:r,loadingRepositories:o,projects:s,repositories:c,searching:l,searchResults:p,searchQuery:m,selectedRepository:g,settings:u,showPersonalAccessTokenForm:h,submittingToken:b,tokenValidationFailed:j}=e;return n.createElement(n.Fragment,null,n.createElement(J,{additionalActions:!h&&n.createElement("div",{className:"display-flex-center pull-right"},n.createElement(E.a,{className:"spacer-right",loading:a}),n.createElement(y.Button,{className:"button-large button-primary",disabled:!g||a,onClick:e.onImportRepository},Object(i.translate)("onboarding.create_project.import_selected_repo"))),title:n.createElement("span",{className:"text-middle"},n.createElement("img",{alt:"",className:"spacer-right",height:"24",src:"".concat(Object(v.getBaseUrl)(),"/images/alm/azure.svg")}),Object(i.translate)("onboarding.create_project.azure.title"))}),r&&n.createElement("i",{className:"spinner"}),!r&&!(u&&u.url)&&n.createElement(H,{alm:d.a.Azure,canAdmin:!!t}),!r&&u&&(h?n.createElement("div",{className:"display-flex-justify-center"},n.createElement(x,{almSetting:u,onPersonalAccessTokenCreate:e.onPersonalAccessTokenCreate,submitting:b,validationFailed:j})):n.createElement(n.Fragment,null,n.createElement("div",{className:"huge-spacer-bottom"},n.createElement(f.a,{onChange:e.onSearch,placeholder:Object(i.translate)("onboarding.create_project.search_projects_repositories")})),n.createElement(E.a,{loading:Boolean(l)},n.createElement(U,{importing:a,loadingRepositories:o,onOpenProject:e.onOpenProject,onSelectRepository:e.onSelectRepository,projects:s,repositories:c,searchResults:p,searchQuery:m,selectedRepository:g})))))}function X(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?X(Object(a),!0).forEach((function(t){Z(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):X(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Z(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ee extends n.PureComponent{constructor(e){super(e),this.mounted=!1,this.fetchInitialData=async()=>{this.setState({loading:!0});const e=await this.checkPersonalAccessToken().catch(()=>!1);let t;e&&(t=await this.fetchAzureProjects());const{repositories:a}=this.state;let n;if(t&&t.length>0){n=t[0].name,this.setState(({loadingRepositories:e})=>({loadingRepositories:Y({},e,{[n]:!0})}));const e=await this.fetchAzureRepositories(n);a[n]=e}this.mounted&&this.setState(({loadingRepositories:r})=>(n&&(r[n]=!1),{patIsValid:e,loading:!1,loadingRepositories:Y({},r),projects:t,repositories:a}))},this.fetchAzureProjects=()=>{const{settings:e}=this.state;return e?(t=e.key,Object(u.getJSON)("/api/alm_integrations/list_azure_projects",{almSetting:t}).catch(h.a)).then(({projects:e})=>e):Promise.resolve(void 0);var t},this.fetchAzureRepositories=e=>{const{settings:t}=this.state;return t?function(e,t){return Object(u.getJSON)("/api/alm_integrations/search_azure_repos",{almSetting:e,projectName:t}).catch(h.a)}(t.key,e).then(({repositories:e})=>e).catch(()=>[]):Promise.resolve([])},this.cleanUrl=()=>{const{location:e,router:t}=this.props;delete e.query.resetPat,t.replace(e)},this.handleOpenProject=async e=>{if(this.state.searchResults)return;this.setState(({loadingRepositories:t})=>({loadingRepositories:Y({},t,{[e]:!0})}));const t=await this.fetchAzureRepositories(e);this.setState(({loadingRepositories:a,repositories:n})=>({loadingRepositories:Y({},a,{[e]:!1}),repositories:Y({},n,{[e]:t})}))},this.handleSearchRepositories=async e=>{const{settings:t}=this.state;if(!t)return;if(0===e.length)return void this.setState({searchResults:void 0,searchQuery:void 0});this.setState({searching:!0});const a=await function(e,t){return Object(u.getJSON)("/api/alm_integrations/search_azure_repos",{almSetting:e,searchQuery:t}).catch(h.a)}(t.key,e).then(({repositories:e})=>e).catch(()=>[]);this.mounted&&this.setState({searching:!1,searchResults:g()(a,"projectName"),searchQuery:e})},this.handleImportRepository=async()=>{const{selectedRepository:e,settings:t}=this.state;if(!t||!e)return;this.setState({importing:!0});const a=await(n=t.key,r=e.projectName,i=e.name,Object(u.postJSON)("/api/alm_integrations/import_azure_project",{almSetting:n,projectName:r,repositoryName:i}).catch(h.a)).then(({project:e})=>e).catch(()=>{});var n,r,i;this.mounted&&(this.setState({importing:!1}),a&&this.props.onProjectCreate([a.key]))},this.handleSelectRepository=e=>{this.setState({selectedRepository:e})},this.checkPersonalAccessToken=()=>{const{settings:e}=this.state;return e?j(e.key):Promise.resolve(!1)},this.handlePersonalAccessTokenCreate=async e=>{const{settings:t}=this.state;if(t&&!(e.length<1)){this.setState({submittingToken:!0,tokenValidationFailed:!1});try{await b(t.key,e);const a=await this.checkPersonalAccessToken();this.mounted&&(this.setState({submittingToken:!1,patIsValid:a,tokenValidationFailed:!a}),a&&(this.cleanUrl(),this.fetchInitialData()))}catch(e){this.mounted&&this.setState({submittingToken:!1})}}},this.state={settings:e.settings[0],importing:!1,loading:!1,loadingRepositories:{},repositories:{},tokenValidationFailed:!1}}componentDidMount(){this.mounted=!0,this.fetchInitialData()}componentDidUpdate(e){0===e.settings.length&&this.props.settings.length>0&&this.setState({settings:1===this.props.settings.length?this.props.settings[0]:void 0},()=>this.fetchInitialData())}componentWillUnmount(){this.mounted=!1}render(){const{canAdmin:e,loadingBindings:t,location:a}=this.props,{importing:r,loading:i,loadingRepositories:o,patIsValid:s,projects:c,repositories:l,searching:p,searchResults:d,searchQuery:m,selectedRepository:g,settings:u,submittingToken:h,tokenValidationFailed:b}=this.state;return n.createElement($,{canAdmin:e,importing:r,loading:i||t,loadingRepositories:o,onImportRepository:this.handleImportRepository,onOpenProject:this.handleOpenProject,onPersonalAccessTokenCreate:this.handlePersonalAccessTokenCreate,onSearch:this.handleSearchRepositories,onSelectRepository:this.handleSelectRepository,projects:c,repositories:l,searching:p,searchResults:d,searchQuery:m,selectedRepository:g,settings:u,showPersonalAccessTokenForm:!s||Boolean(a.query.resetPat),submittingToken:h,tokenValidationFailed:b})}}var te=a(356),ae=a.n(te),ne=a(426),re=a.n(ne);function ie(e){var t;const{disableRepositories:a,open:r,project:o,repositories:s,selectedRepository:c,showingAllRepositories:l}=e,d=s.length,m=null!==(t=null==o?void 0:o.name)&&void 0!==t?t:Object(i.translate)("search_results");return n.createElement(L.a,{className:S("big-spacer-bottom",{open:r,"not-clickable":!e.onClick,"no-hover":!e.onClick}),onClick:e.onClick?e.onClick:()=>{},open:r,title:n.createElement("h3",null,m)},r&&n.createElement(n.Fragment,null,n.createElement("div",{className:"display-flex-wrap"},0===d&&n.createElement(I.Alert,{variant:"warning"},n.createElement(O.FormattedMessage,{defaultMessage:Object(i.translate)("onboarding.create_project.no_bbs_repos"),id:"onboarding.create_project.no_bbs_repos",values:{link:n.createElement(C.Link,{to:{pathname:"/projects/create",query:{mode:z.BitbucketServer,resetPat:1}}},Object(i.translate)("onboarding.create_project.update_your_token"))}})),s.map(t=>t.sqProjectKey?n.createElement("div",{className:"display-flex-start spacer-right spacer-bottom create-project-import-bbs-repo",key:t.id},n.createElement(D.a,{className:"spacer-right",fill:V.colors.green,size:14}),n.createElement("div",{className:"overflow-hidden"},n.createElement("div",{className:"little-spacer-bottom text-ellipsis"},n.createElement("strong",{title:t.name},n.createElement(C.Link,{to:Object(p.v)(t.sqProjectKey)},t.name))),n.createElement("em",null,Object(i.translate)("onboarding.create_project.repository_imported")))):n.createElement(K.a,{checked:(null==c?void 0:c.id)===t.id,className:S("display-flex-start spacer-right spacer-bottom create-project-import-bbs-repo overflow-hidden",{disabled:a,"text-muted":a,"link-no-underline":a}),key:t.id,onCheck:()=>e.onSelectRepository(t),value:String(t.id)},n.createElement("strong",{className:"text-ellipsis",title:t.name},t.name)))),!l&&d>0&&n.createElement(I.Alert,{variant:"warning"},Object(i.translateWithParameters)("onboarding.create_project.only_showing_X_first_repos",d))))}function oe(e){const{disableRepositories:t,projects:a,projectRepositories:r,selectedRepository:o}=e,[s,c]=n.useState(a.length>0?[a[0].key]:[]),l=a.length<=s.length;return n.createElement(n.Fragment,null,n.createElement("div",{className:"overflow-hidden spacer-bottom"},n.createElement(y.ButtonLink,{className:"pull-right",onClick:()=>c(l?[]:a.map(e=>e.key))},l?Object(i.translate)("collapse_all"):Object(i.translate)("expand_all"))),a.map(a=>{const i=s.includes(a.key),{allShown:l,repositories:p=[]}=r[a.key]||{};return n.createElement(ie,{disableRepositories:t,key:a.key,onClick:()=>((e,t)=>{c(e?ae()(s,t):re()([...s,t]))})(i,a.key),onSelectRepository:e.onSelectRepository,open:i,project:a,repositories:p,selectedRepository:o,showingAllRepositories:l})}))}function se(e){const{disableRepositories:t,projects:a,searching:r,searchResults:o=[],selectedRepository:s}=e;if(0===o.length&&!r)return n.createElement(I.Alert,{className:"big-spacer-top",variant:"warning"},Object(i.translate)("onboarding.create_project.no_bbs_repos.filter"));const c=a.filter(e=>o.some(t=>t.projectKey===e.key)),l=c.map(e=>e.key),p=o.filter(e=>!l.includes(e.projectKey));return n.createElement("div",{className:"big-spacer-top"},n.createElement(E.a,{loading:r},p.length>0&&n.createElement(ie,{disableRepositories:t,onSelectRepository:e.onSelectRepository,open:!0,repositories:p,selectedRepository:s,showingAllRepositories:!0}),c.map(a=>{const r=o.filter(e=>e.projectKey===a.key);return n.createElement(ie,{disableRepositories:t,key:a.key,onSelectRepository:e.onSelectRepository,open:!0,project:a,repositories:r,selectedRepository:s,showingAllRepositories:!0})})))}function ce(e){const{disableRepositories:t,projects:a=[],projectRepositories:r={},searchResults:o,searching:s,selectedRepository:c}=e;return 0===a.length?n.createElement(I.Alert,{className:"spacer-top",variant:"warning"},n.createElement(O.FormattedMessage,{defaultMessage:Object(i.translate)("onboarding.create_project.no_bbs_projects"),id:"onboarding.create_project.no_bbs_projects",values:{link:n.createElement(C.Link,{to:{pathname:"/projects/create",query:{mode:z.BitbucketServer,resetPat:1}}},Object(i.translate)("onboarding.create_project.update_your_token"))}})):n.createElement("div",{className:"create-project-import-bbs"},n.createElement(f.a,{onChange:e.onSearch,placeholder:Object(i.translate)("onboarding.create_project.search_repositories_by_name")}),s||o?n.createElement(se,{disableRepositories:t,onSelectRepository:e.onSelectRepository,projects:a,searchResults:o,searching:s,selectedRepository:c}):n.createElement(oe,{disableRepositories:t,onSelectRepository:e.onSelectRepository,projectRepositories:r,projects:a,selectedRepository:c}))}function le(e,t){return e===d.a.Bitbucket?"".concat(t.replace(/\/$/,""),"/plugins/servlet/access-tokens/add"):t.endsWith("/api/v4")?"".concat(t.replace("/api/v4","").replace(/\/$/,""),"/profile/personal_access_tokens"):"https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html#creating-a-personal-access-token"}function pe(e){const{almSetting:{alm:t,url:a},submitting:r=!1,validationFailed:o}=e,[s,c]=n.useState(!1);n.useEffect(()=>{c(!1)},[r]);const l=o&&!s;return n.createElement("div",{className:"display-flex-start"},n.createElement("form",{className:"width-50",onSubmit:t=>{t.preventDefault();const a=new FormData(t.currentTarget).get("personal_access_token");e.onPersonalAccessTokenCreate(a)}},n.createElement("h2",{className:"big"},Object(i.translate)("onboarding.create_project.pat_form.title",t)),n.createElement("p",{className:"big-spacer-top big-spacer-bottom"},Object(i.translate)("onboarding.create_project.pat_form.help",t)),n.createElement(P.a,{error:l?Object(i.translate)("onboarding.create_project.pat_incorrect",t):void 0,id:"personal_access_token",isInvalid:l,isValid:!1,label:Object(i.translate)("onboarding.create_project.enter_pat"),required:!0},n.createElement("input",{autoFocus:!0,className:S("input-super-large",{"is-invalid":l}),id:"personal_access_token",minLength:1,name:"personal_access_token",onChange:()=>{c(!0)},type:"text"})),n.createElement(y.SubmitButton,{disabled:l||r||!s},Object(i.translate)("save")),n.createElement(E.a,{className:"spacer-left",loading:r})),n.createElement(I.Alert,{className:"big-spacer-left width-50",display:"block",variant:"info"},n.createElement("h3",null,Object(i.translate)("onboarding.create_project.pat_help.title")),n.createElement("p",{className:"big-spacer-top big-spacer-bottom"},n.createElement(O.FormattedMessage,{id:"onboarding.create_project.pat_help.instructions",defaultMessage:Object(i.translate)("onboarding.create_project.pat_help.instructions"),values:{alm:Object(i.translate)("onboarding.alm",t)}})),a&&n.createElement("div",{className:"text-middle"},n.createElement("img",{alt:"",className:"spacer-right",height:"16",src:"".concat(Object(v.getBaseUrl)(),"/images/alm/").concat(t,".svg")}),n.createElement("a",{href:le(t,a),rel:"noopener noreferrer",target:"_blank"},Object(i.translate)("onboarding.create_project.pat_help.link"))),n.createElement("p",{className:"big-spacer-top big-spacer-bottom"},Object(i.translate)("onboarding.create_project.pat_help.instructions2",t)),n.createElement("ul",null,t===d.a.Bitbucket&&n.createElement(n.Fragment,null,n.createElement("li",null,n.createElement(O.FormattedMessage,{defaultMessage:Object(i.translate)("onboarding.create_project.pat_help.bbs_permission_projects"),id:"onboarding.create_project.pat_help.bbs_permission_projects",values:{perm:n.createElement("strong",null,Object(i.translate)("onboarding.create_project.pat_help.read_permission"))}})),n.createElement("li",null,n.createElement(O.FormattedMessage,{defaultMessage:Object(i.translate)("onboarding.create_project.pat_help.bbs_permission_repos"),id:"onboarding.create_project.pat_help.bbs_permission_repos",values:{perm:n.createElement("strong",null,Object(i.translate)("onboarding.create_project.pat_help.read_permission"))}}))),t===d.a.GitLab&&n.createElement("li",{className:"spacer-bottom"},n.createElement("strong",null,Object(i.translate)("onboarding.create_project.pat_help.gitlab.read_api_permission"))))))}function de(e){const{bitbucketSetting:t,canAdmin:a,importing:r,loading:o,projects:s,projectRepositories:c,selectedRepository:l,searching:p,searchResults:m,showPersonalAccessTokenForm:g,submittingToken:u,tokenValidationFailed:h}=e;return n.createElement(n.Fragment,null,n.createElement(J,{additionalActions:!g&&n.createElement("div",{className:"display-flex-center pull-right"},n.createElement(E.a,{className:"spacer-right",loading:r}),n.createElement(y.Button,{className:"button-large button-primary",disabled:!l||r,onClick:e.onImportRepository},Object(i.translate)("onboarding.create_project.import_selected_repo"))),title:n.createElement("span",{className:"text-middle"},n.createElement("img",{alt:"",className:"spacer-right",height:"24",src:"".concat(Object(v.getBaseUrl)(),"/images/alm/bitbucket.svg")}),Object(i.translate)("onboarding.create_project.from_bbs"))}),o&&n.createElement("i",{className:"spinner"}),!o&&!t&&n.createElement(H,{alm:d.a.Bitbucket,canAdmin:!!a}),!o&&t&&(g?n.createElement(pe,{almSetting:t,onPersonalAccessTokenCreate:e.onPersonalAccessTokenCreate,submitting:u,validationFailed:h}):n.createElement(ce,{disableRepositories:r,onSearch:e.onSearch,onSelectRepository:e.onSelectRepository,projectRepositories:c,projects:s,searchResults:m,searching:p,selectedRepository:l})))}function me(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ge(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ue extends n.PureComponent{constructor(e){super(e),this.mounted=!1,this.fetchInitialData=async()=>{this.setState({loading:!0});const e=await this.checkPersonalAccessToken().catch(()=>!1);let t,a;e&&(t=await this.fetchBitbucketProjects().catch(()=>{})),t&&t.length>0&&(a=await this.fetchBitbucketRepositories(t).catch(()=>{})),this.mounted&&this.setState({patIsValid:e,projects:t,projectRepositories:a,loading:!1})},this.checkPersonalAccessToken=()=>{const{bitbucketSetting:e}=this.state;return e?j(e.key):Promise.resolve(!1)},this.fetchBitbucketProjects=()=>{const{bitbucketSetting:e}=this.state;return e?(t=e.key,Object(u.getJSON)("/api/alm_integrations/list_bitbucketserver_projects",{almSetting:t})).then(({projects:e})=>e):Promise.resolve(void 0);var t},this.fetchBitbucketRepositories=e=>{const{bitbucketSetting:t}=this.state;return t?Promise.all(e.map(e=>{return(a=t.key,n=e.name,Object(u.getJSON)("/api/alm_integrations/search_bitbucketserver_repos",{almSetting:a,projectName:n})).then(({isLastPage:t,repositories:a})=>{const n=a.filter(t=>t.projectKey===e.key);return{repositories:n,isLastPage:t||n.length<25,projectKey:e.key}});var a,n})).then(e=>e.reduce((e,{isLastPage:t,projectKey:a,repositories:n})=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?me(Object(a),!0).forEach((function(t){ge(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):me(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e,{[a]:{allShown:t,repositories:n}}),{})):Promise.resolve(void 0)},this.handlePersonalAccessTokenCreate=e=>{const{bitbucketSetting:t}=this.state;!t||e.length<1||(this.setState({submittingToken:!0,tokenValidationFailed:!1}),b(t.key,e).then(this.checkPersonalAccessToken).then(e=>{this.mounted&&(this.setState({submittingToken:!1,patIsValid:e,tokenValidationFailed:!e}),e&&this.fetchInitialData())}).catch(()=>{this.mounted&&this.setState({submittingToken:!1})}))},this.handleImportRepository=()=>{const{bitbucketSetting:e,selectedRepository:t}=this.state;var a,n,r;e&&t&&(this.setState({importing:!0}),(a=e.key,n=t.projectKey,r=t.slug,Object(u.postJSON)("/api/alm_integrations/import_bitbucketserver_project",{almSetting:a,projectKey:n,repositorySlug:r}).catch(h.a)).then(({project:{key:e}})=>{this.mounted&&(this.setState({importing:!1}),this.props.onProjectCreate([e]))}).catch(()=>{this.mounted&&this.setState({importing:!1})}))},this.handleSearch=e=>{const{bitbucketSetting:t}=this.state;var a,n;t&&(e?(this.setState({searching:!0,selectedRepository:void 0}),(a=t.key,n=e,Object(u.getJSON)("/api/alm_integrations/search_bitbucketserver_repos",{almSetting:a,repositoryName:n})).then(({repositories:e})=>{this.mounted&&this.setState({searching:!1,searchResults:e})}).catch(()=>{this.mounted&&this.setState({searching:!1})})):this.setState({searching:!1,searchResults:void 0,selectedRepository:void 0}))},this.handleSelectRepository=e=>{this.setState({selectedRepository:e})},this.state={bitbucketSetting:e.bitbucketSettings[0],importing:!1,loading:!1,searching:!1,tokenValidationFailed:!1}}componentDidMount(){this.mounted=!0,this.fetchInitialData()}componentDidUpdate(e){0===e.bitbucketSettings.length&&this.props.bitbucketSettings.length>0&&this.setState({bitbucketSetting:this.props.bitbucketSettings[0]},()=>this.fetchInitialData())}componentWillUnmount(){this.mounted=!1}render(){const{canAdmin:e,loadingBindings:t,location:a}=this.props,{bitbucketSetting:r,importing:i,loading:o,patIsValid:s,projectRepositories:c,projects:l,searching:p,searchResults:d,selectedRepository:m,submittingToken:g,tokenValidationFailed:u}=this.state;return n.createElement(de,{bitbucketSetting:r,canAdmin:e,importing:i,loading:o||t,onImportRepository:this.handleImportRepository,onPersonalAccessTokenCreate:this.handlePersonalAccessTokenCreate,onProjectCreate:this.props.onProjectCreate,onSearch:this.handleSearch,onSelectRepository:this.handleSelectRepository,projectRepositories:c,projects:l,searchResults:d,searching:p,selectedRepository:m,showPersonalAccessTokenForm:!s||Boolean(a.query.resetPat),submittingToken:g,tokenValidationFailed:u})}}var he=a(324),be=a.n(he);function je(e,t,a){const{almCounts:r,loadingBindings:o}=e,s=r[t],c=1!==s||o;return n.createElement("button",{className:S("button button-huge big-spacer-left display-flex-column create-project-mode-type-alm",{disabled:c}),disabled:c,onClick:()=>e.onSelectMode(a),type:"button"},n.createElement("img",{alt:"",height:80,src:"".concat(Object(v.getBaseUrl)(),"/images/alm/").concat(t,".svg")}),n.createElement("div",{className:"medium big-spacer-top"},Object(i.translate)("onboarding.create_project.select_method",t)),o&&n.createElement("span",null,Object(i.translate)("onboarding.create_project.check_alm_supported"),n.createElement("i",{className:"little-spacer-left spinner"})),!o&&c&&n.createElement("div",{className:"text-muted small spacer-top",style:{lineHeight:1.5}},Object(i.translate)("onboarding.create_project.alm_not_configured"),n.createElement(be.a,{className:"little-spacer-left",overlay:0===s?Object(i.translate)("onboarding.create_project.zero_alm_instances",t):"".concat(Object(i.translate)("onboarding.create_project.too_many_alm_instances",t)," \n                  ").concat(Object(i.translateWithParameters)("onboarding.create_project.alm_instances_count_X",s))})))}function ye(e){return n.createElement(n.Fragment,null,n.createElement("header",{className:"huge-spacer-top big-spacer-bottom padded"},n.createElement("h1",{className:"text-center huge big-spacer-bottom"},Object(i.translate)("my_account.create_new.TRK")),n.createElement("p",{className:"text-center big"},Object(i.translate)("onboarding.create_project.select_method"))),n.createElement("div",{className:"create-project-modes huge-spacer-top display-flex-justify-center"},n.createElement("button",{className:"button button-huge display-flex-column create-project-mode-type-manual",onClick:()=>e.onSelectMode(z.Manual),type:"button"},n.createElement("img",{alt:"",height:80,src:"".concat(Object(v.getBaseUrl)(),"/images/sonarcloud/analysis/manual.svg")}),n.createElement("div",{className:"medium big-spacer-top"},Object(i.translate)("onboarding.create_project.select_method.manual"))),je(e,d.a.Azure,z.AzureDevOps),je(e,d.a.Bitbucket,z.BitbucketServer),je(e,d.a.GitHub,z.GitHub),je(e,d.a.GitLab,z.GitLab)))}var _e=a(373),fe=a.n(_e),ke=a(634),Ee=a.n(ke),ve=a(6);function Se({key:e,name:t}){return{value:e,label:t}}const Oe=e=>t=>Promise.resolve(e.filter(e=>!t||e.name.includes(t)).map(Se));function Ne(e){const{canAdmin:t,error:a,importing:r,loadingBindings:o,loadingOrganizations:s,organizations:c,selectedOrganization:l,selectedRepository:p}=e;return o?n.createElement(E.a,null):n.createElement("div",null,n.createElement(J,{additionalActions:l&&n.createElement("div",{className:"display-flex-center pull-right"},n.createElement(E.a,{className:"spacer-right",loading:r}),n.createElement(y.Button,{className:"button-large button-primary",disabled:!p||r,onClick:e.onImportRepository},Object(i.translate)("onboarding.create_project.import_selected_repo"))),title:n.createElement("span",{className:"text-middle display-flex-center"},n.createElement("img",{alt:"",className:"spacer-right",height:24,src:"".concat(Object(ve.getBaseUrl)(),"/images/alm/github.svg")}),Object(i.translate)("onboarding.create_project.github.title"))}),a?n.createElement("div",{className:"display-flex-justify-center"},n.createElement("div",{className:"boxed-group padded width-50 huge-spacer-top"},n.createElement("h2",{className:"big-spacer-bottom"},Object(i.translate)("onboarding.create_project.github.warning.title")),n.createElement(I.Alert,{variant:"warning"},t?n.createElement(O.FormattedMessage,{id:"onboarding.create_project.github.warning.message_admin",defaultMessage:Object(i.translate)("onboarding.create_project.github.warning.message_admin"),values:{link:n.createElement(C.Link,{to:"/admin/settings?category=almintegration"},Object(i.translate)("onboarding.create_project.github.warning.message_admin.link"))}}):Object(i.translate)("onboarding.create_project.github.warning.message")))):n.createElement(E.a,{loading:s},n.createElement("div",{className:"form-field"},n.createElement("label",null,Object(i.translate)("onboarding.create_project.github.choose_organization")),c.length>0?n.createElement(Ee.a,{defaultOptions:c.map(Se),onSearch:Oe(c),minimumQueryLength:0,onSelect:({value:t})=>e.onSelectOrganization(t),value:l&&Se(l)}):!s&&n.createElement(I.Alert,{className:"spacer-top",variant:"error"},t?n.createElement(O.FormattedMessage,{id:"onboarding.create_project.github.no_orgs_admin",defaultMessage:Object(i.translate)("onboarding.create_project.github.no_orgs_admin"),values:{link:n.createElement(C.Link,{to:"/admin/settings?category=almintegration"},Object(i.translate)("onboarding.create_project.github.warning.message_admin.link"))}}):Object(i.translate)("onboarding.create_project.github.no_orgs")))),function(e){const{importing:t,loadingRepositories:a,repositories:r,repositoryPaging:o,searchQuery:s,selectedOrganization:c,selectedRepository:l}=e,p=e=>!!e.sqProjectKey||a||t;return c&&r&&n.createElement("div",{className:"boxed-group padded display-flex-wrap"},n.createElement("div",{className:"width-100"},n.createElement(f.a,{className:"big-spacer-bottom",onChange:e.onSearch,placeholder:Object(i.translate)("onboarding.create_project.search_repositories"),value:s})),0===r.length?n.createElement("div",{className:"padded"},n.createElement(E.a,{loading:a},Object(i.translate)("no_results"))):r.map(t=>{return n.createElement(K.a,{className:"spacer-top spacer-bottom padded create-project-github-repository",key:t.key,checked:(a=t,!!a.sqProjectKey||!!l&&l.key===a.key),disabled:p(t),value:t.key,onCheck:e.onSelectRepository},n.createElement("div",{className:"big overflow-hidden",title:t.name},n.createElement("div",{className:"text-ellipsis"},t.name),t.sqProjectKey&&n.createElement("em",{className:"notice text-muted-2 small display-flex-center"},Object(i.translate)("onboarding.create_project.repository_imported"),n.createElement(D.a,{className:"little-spacer-left",size:12}))));var a}),n.createElement("div",{className:"display-flex-justify-center width-100"},n.createElement(M.a,{count:r.length,total:o.total,loadMore:e.onLoadMore,loading:a})))}(e))}class Pe extends n.Component{constructor(e){super(e),this.mounted=!1,this.triggerSearch=e=>{const{selectedOrganization:t}=this.state;t&&(this.setState({selectedRepository:void 0}),this.fetchRepositories({organizationKey:t.key,query:e}))},this.handleSelectOrganization=e=>{this.setState(({organizations:t})=>({searchQuery:"",selectedRepository:void 0,selectedOrganization:t.find(t=>t.key===e)})),this.fetchRepositories({organizationKey:e})},this.handleSelectRepository=e=>{this.setState(({repositories:t})=>({selectedRepository:null==t?void 0:t.find(t=>t.key===e)}))},this.handleSearch=e=>{this.setState({searchQuery:e}),this.triggerSearch(e)},this.handleLoadMore=()=>{const{repositoryPaging:e,searchQuery:t,selectedOrganization:a}=this.state;a&&this.fetchRepositories({organizationKey:a.key,page:e.pageIndex+1,query:t})},this.handleImportRepository=async()=>{const{selectedOrganization:e,selectedRepository:t,settings:a}=this.state;if(a&&e&&t){this.setState({importing:!0});try{const{project:o}=await(n=a.key,r=e.key,i=t.key,Object(u.postJSON)("/api/alm_integrations/import_github_project",{almSetting:n,organization:r,repositoryKey:i}).catch(h.a));this.props.onProjectCreate([o.key])}finally{this.mounted&&this.setState({importing:!1})}}var n,r,i},this.state={error:!1,importing:!1,loadingOrganizations:!0,loadingRepositories:!1,organizations:[],repositories:[],repositoryPaging:{pageSize:30,total:0,pageIndex:1},searchQuery:"",settings:e.settings[0]},this.triggerSearch=fe()(this.triggerSearch,250)}componentDidMount(){this.mounted=!0,this.initialize()}componentDidUpdate(e){0===e.settings.length&&this.props.settings.length>0&&this.setState({settings:this.props.settings[0]},()=>this.initialize())}componentWillUnmount(){this.mounted=!1}async initialize(){var e;const{location:t,router:a}=this.props,{settings:n}=this.state;if(!n||!n.url)return void this.setState({error:!0});this.setState({error:!1});const r=null===(e=t.query)||void 0===e?void 0:e.code;try{r?(delete t.query.code,a.replace(t),await this.fetchOrganizations(n,r)):await this.redirectToGithub(n)}catch(e){this.mounted&&this.setState({error:!0})}}async redirectToGithub(e){if(!e.url)return;const{clientId:t}=await(a=e.key,Object(u.getJSON)("/api/alm_integrations/get_github_client_id",{almSetting:a}));var a;if(!t)return void this.setState({error:!0});const n=[{param:"client_id",value:t},{param:"redirect_uri",value:"".concat(Object(v.getHostUrl)(),"/projects/create?mode=").concat(d.a.GitHub)}].map(({param:e,value:t})=>"".concat(e,"=").concat(t)).join("&");let r;r=e.url.includes("/api/v3")?e.url.replace("/api/v3",""):e.url.replace("api.",""),r=r.replace(/\/$/,""),window.location.replace("".concat(r,"/login/oauth/authorize?").concat(n))}async fetchOrganizations(e,t){const{organizations:a}=await function(e,t){return Object(u.getJSON)("/api/alm_integrations/list_github_organizations",{almSetting:e,token:t}).catch(e=>{e&&400!==e.status&&Object(h.a)(e)})}(e.key,t);this.mounted&&this.setState({loadingOrganizations:!1,organizations:a})}async fetchRepositories(e){const{organizationKey:t,page:a=1,query:n}=e,{settings:r}=this.state;if(r){this.setState({loadingRepositories:!0});try{const e=await function(e){const{almSetting:t,organization:a,pageSize:n,page:r=1,query:i}=e;return Object(u.getJSON)("/api/alm_integrations/list_github_repositories",{almSetting:t,organization:a,p:r,ps:n,q:i||void 0}).catch(h.a)}({almSetting:r.key,organization:t,pageSize:30,page:a,query:n});this.mounted&&this.setState(({repositories:t})=>({loadingRepositories:!1,repositoryPaging:e.paging,repositories:1===a?e.repositories:[...t,...e.repositories]}))}catch(e){this.mounted&&this.setState({loadingRepositories:!1,repositoryPaging:{pageIndex:1,pageSize:30,total:0},repositories:[]})}}else this.setState({error:!0})}render(){const{canAdmin:e,loadingBindings:t}=this.props,{error:a,importing:r,loadingOrganizations:i,loadingRepositories:o,organizations:s,repositoryPaging:c,repositories:l,searchQuery:p,selectedOrganization:d,selectedRepository:m}=this.state;return n.createElement(Ne,{canAdmin:e,error:a,importing:r,loadingBindings:t,loadingOrganizations:i,loadingRepositories:o,onImportRepository:this.handleImportRepository,onLoadMore:this.handleLoadMore,onSearch:this.handleSearch,onSelectOrganization:this.handleSelectOrganization,onSelectRepository:this.handleSelectRepository,organizations:s,repositoryPaging:c,searchQuery:p,repositories:l,selectedOrganization:d,selectedRepository:m})}}var Re=a(317),we=a.n(Re),Ae=a(340),xe=a.n(Ae),ze=a(335);function Ce(e){const{importingGitlabProjectId:t,loadingMore:a,projects:r=[],projectsPaging:o,searching:s,searchQuery:c}=e;return 0!==r.length||0!==c.length||s?n.createElement("div",{className:"boxed-group big-padded create-project-import-gitlab"},n.createElement(f.a,{className:"spacer",loading:s,minLength:3,onChange:e.onSearch,placeholder:Object(i.translate)("onboarding.create_project.gitlab.search_prompt")}),n.createElement("hr",null),0===r.length?n.createElement("div",{className:"padded"},Object(i.translate)("no_results")):n.createElement("table",{className:"data zebra zebra-hover"},n.createElement("tbody",null,r.map(a=>n.createElement("tr",{key:a.id},n.createElement("td",null,n.createElement(we.a,{overlay:a.slug},n.createElement("strong",{className:"project-name display-inline-block text-ellipsis"},a.name)),n.createElement("br",null),n.createElement(we.a,{overlay:a.pathSlug},n.createElement("span",{className:"text-muted project-path display-inline-block text-ellipsis"},a.pathName))),n.createElement("td",null,n.createElement("a",{className:"display-inline-flex-center big-spacer-right",href:a.url,rel:"noopener noreferrer",target:"_blank"},n.createElement(w.a,{className:"little-spacer-right"}),Object(i.translate)("onboarding.create_project.gitlab.link"))),a.sqProjectKey?n.createElement(n.Fragment,null,n.createElement("td",null,n.createElement("span",{className:"display-flex-center display-flex-justify-end already-set-up"},n.createElement(D.a,{className:"little-spacer-right",size:12}),Object(i.translate)("onboarding.create_project.repository_imported"),":")),n.createElement("td",null,n.createElement("div",{className:"sq-project-link text-ellipsis"},n.createElement(C.Link,{to:Object(p.v)(a.sqProjectKey)},n.createElement(xe.a,{className:"spacer-right",qualifier:ze.a.Project}),a.sqProjectName)))):n.createElement("td",{colSpan:2,className:"text-right"},n.createElement(y.Button,{disabled:!!t,onClick:()=>e.onImport(a.id)},Object(i.translate)("onboarding.create_project.gitlab.set_up"),t===a.id&&n.createElement(E.a,{className:"spacer-left"}))))))),n.createElement(M.a,{count:r.length,loadMore:e.onLoadMore,loading:a,total:o.total})):n.createElement(I.Alert,{className:"spacer-top",variant:"warning"},n.createElement(O.FormattedMessage,{defaultMessage:Object(i.translate)("onboarding.create_project.gitlab.no_projects"),id:"onboarding.create_project.gitlab.no_projects",values:{link:n.createElement(C.Link,{to:{pathname:"/projects/create",query:{mode:z.GitLab,resetPat:1}}},Object(i.translate)("onboarding.create_project.update_your_token"))}}))}function Fe(e){const{canAdmin:t,importingGitlabProjectId:a,loading:r,loadingMore:o,projects:s,projectsPaging:c,searching:l,searchQuery:p,settings:m,showPersonalAccessTokenForm:g,submittingToken:u,tokenValidationFailed:h}=e;return n.createElement(n.Fragment,null,n.createElement(J,{title:n.createElement("span",{className:"text-middle"},n.createElement("img",{alt:"",className:"spacer-right",height:"24",src:"".concat(Object(v.getBaseUrl)(),"/images/alm/gitlab.svg")}),Object(i.translate)("onboarding.create_project.gitlab.title"))}),r&&n.createElement("i",{className:"spinner"}),!r&&!m&&n.createElement(H,{alm:d.a.GitLab,canAdmin:!!t}),!r&&m&&(g?n.createElement(pe,{almSetting:m,onPersonalAccessTokenCreate:e.onPersonalAccessTokenCreate,submitting:u,validationFailed:h}):n.createElement(Ce,{importingGitlabProjectId:a,loadingMore:o,onImport:e.onImport,onLoadMore:e.onLoadMore,onSearch:e.onSearch,projects:s,projectsPaging:c,searching:l,searchQuery:p})))}class Me extends n.PureComponent{constructor(e){super(e),this.mounted=!1,this.fetchInitialData=async()=>{this.setState({loading:!0});const e=await this.checkPersonalAccessToken();let t;if(e&&(t=await this.fetchProjects()),this.mounted)if(t){const{projects:a,projectsPaging:n}=t;this.setState({tokenIsValid:e,loading:!1,projects:a,projectsPaging:n})}else this.setState({loading:!1})},this.checkPersonalAccessToken=()=>{const{settings:e}=this.state;return e?j(e.key).catch(()=>!1):Promise.resolve(!1)},this.handleError=()=>{this.mounted&&this.setState({tokenIsValid:!1})},this.fetchProjects=async(e=1,t)=>{const{settings:a}=this.state;if(!a)return Promise.resolve(void 0);try{return await function(e){const{almSetting:t,pageSize:a,page:n,query:r}=e;return Object(u.getJSON)("/api/alm_integrations/search_gitlab_repos",{almSetting:t,projectName:r||void 0,p:n,ps:a}).then(({repositories:e,paging:t})=>({projects:e,projectsPaging:t})).catch(h.a)}({almSetting:a.key,page:e,pageSize:30,query:t})}catch(e){return this.handleError()}},this.doImport=async e=>{const{settings:t}=this.state;if(!t)return Promise.resolve(void 0);try{return await function(e){const{almSetting:t,gitlabProjectId:a}=e;return Object(u.postJSON)("/api/alm_integrations/import_gitlab_project",{almSetting:t,gitlabProjectId:a}).catch(h.a)}({almSetting:t.key,gitlabProjectId:e})}catch(e){return this.handleError()}},this.handleImport=async e=>{this.setState({importingGitlabProjectId:e});const t=await this.doImport(e);this.mounted&&(this.setState({importingGitlabProjectId:void 0}),t&&this.props.onProjectCreate([t.project.key]))},this.handleLoadMore=async()=>{this.setState({loadingMore:!0});const{projectsPaging:{pageIndex:e},searchQuery:t}=this.state,a=await this.fetchProjects(e+1,t);this.mounted&&this.setState(({projects:e=[],projectsPaging:t})=>({loadingMore:!1,projects:a?[...e,...a.projects]:e,projectsPaging:a?a.projectsPaging:t}))},this.handleSearch=async e=>{this.setState({searching:!0,searchQuery:e});const t=await this.fetchProjects(1,e);this.mounted&&this.setState(({projects:e,projectsPaging:a})=>({searching:!1,projects:t?t.projects:e,projectsPaging:t?t.projectsPaging:a}))},this.cleanUrl=()=>{const{location:e,router:t}=this.props;delete e.query.resetPat,t.replace(e)},this.handlePersonalAccessTokenCreate=async e=>{const{settings:t}=this.state;if(t&&!(e.length<1)){this.setState({submittingToken:!0,tokenValidationFailed:!1});try{await b(t.key,e);const a=await this.checkPersonalAccessToken();this.mounted&&(this.setState({submittingToken:!1,tokenIsValid:a,tokenValidationFailed:!a}),a&&(this.cleanUrl(),await this.fetchInitialData()))}catch(e){this.mounted&&this.setState({submittingToken:!1})}}},this.state={loading:!1,loadingMore:!1,projectsPaging:{pageIndex:1,total:0,pageSize:30},tokenIsValid:!1,searching:!1,searchQuery:"",settings:1===e.settings.length?e.settings[0]:void 0,submittingToken:!1,tokenValidationFailed:!1}}componentDidMount(){this.mounted=!0,this.fetchInitialData()}componentDidUpdate(e){0===e.settings.length&&this.props.settings.length>0&&this.setState({settings:1===this.props.settings.length?this.props.settings[0]:void 0},()=>this.fetchInitialData())}componentWillUnmount(){this.mounted=!1}render(){const{canAdmin:e,loadingBindings:t,location:a}=this.props,{importingGitlabProjectId:r,loading:i,loadingMore:o,projects:s,projectsPaging:c,tokenIsValid:l,searching:p,searchQuery:d,settings:m,submittingToken:g,tokenValidationFailed:u}=this.state;return n.createElement(Fe,{settings:m,canAdmin:e,importingGitlabProjectId:r,loading:i||t,loadingMore:o,onImport:this.handleImport,onLoadMore:this.handleLoadMore,onPersonalAccessTokenCreate:this.handlePersonalAccessTokenCreate,onSearch:this.handleSearch,projects:s,projectsPaging:c,searching:p,searchQuery:d,showPersonalAccessTokenForm:!l||Boolean(a.query.resetPat),submittingToken:g,tokenValidationFailed:u})}}var Ie=a(367),Te=a(858),Le=a(859);a(1697);class Be extends n.PureComponent{constructor(e){super(e),this.mounted=!1,this.checkFreeKey=e=>Object(Ie.f)({component:e}).then(t=>{this.mounted&&e===this.state.projectKey&&(t?this.setState({projectKeyError:Object(i.translate)("onboarding.create_project.project_key.taken"),touched:!0,validating:!1}):this.setState({projectKeyError:void 0,validating:!1}))}).catch(()=>{this.mounted&&e===this.state.projectKey&&this.setState({projectKeyError:void 0,validating:!1})}),this.handleFormSubmit=e=>{e.preventDefault();const{state:t}=this;this.canSubmit(t)&&(this.setState({submitting:!0}),Object(Ie.c)({project:t.projectKey,name:(t.projectName||t.projectKey).trim()}).then(({project:e})=>this.props.onProjectCreate([e.key]),()=>{this.mounted&&this.setState({submitting:!1})}))},this.handleProjectKeyChange=e=>{const t=e.currentTarget.value||"",a=this.validateKey(t);this.setState(e=>{const n=e.projectNameChanged?e.projectName:t;return{projectKey:t,projectKeyError:a,projectName:n,projectNameError:this.validateName(n),touched:!0,validating:void 0===a}}),void 0===a&&this.checkFreeKey(t)},this.handleProjectNameChange=e=>{const t=e.currentTarget.value;this.setState({projectName:t,projectNameChanged:!0,projectNameError:this.validateName(t)})},this.validateKey=e=>{const t=Object(Le.a)(e);return t===ze.b.Valid?void 0:Object(i.translate)("onboarding.create_project.project_key.error",t)},this.validateName=e=>0===e.length?Object(i.translate)("onboarding.create_project.display_name.error.empty"):e.length>255?Object(i.translate)("onboarding.create_project.display_name.error.too_long"):void 0,this.state={projectKey:"",projectName:"",projectNameChanged:!1,submitting:!1,touched:!1,validating:!1},this.checkFreeKey=fe()(this.checkFreeKey,250)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}canSubmit(e){const{projectKey:t,projectKeyError:a,projectName:n,projectNameError:r}=e;return Boolean(void 0===a&&void 0===r&&t.length>0&&n.length>0)}render(){const{projectKey:e,projectKeyError:t,projectName:a,projectNameError:r,submitting:o,touched:s,validating:c}=this.state,l=s&&void 0!==r,p=s&&void 0===r;return n.createElement(n.Fragment,null,n.createElement(J,{title:Object(i.translate)("onboarding.create_project.setup_manually")}),n.createElement("div",{className:"create-project-manual"},n.createElement("div",{className:"flex-1 huge-spacer-right"},n.createElement("form",{className:"manual-project-create",onSubmit:this.handleFormSubmit},n.createElement(Te.a,{error:t,help:Object(i.translate)("onboarding.create_project.project_key.help"),label:Object(i.translate)("onboarding.create_project.project_key"),onProjectKeyChange:this.handleProjectKeyChange,projectKey:e,touched:s,validating:c}),n.createElement(P.a,{className:"form-field",description:Object(i.translate)("onboarding.create_project.display_name.description"),error:r,help:Object(i.translate)("onboarding.create_project.display_name.help"),id:"project-name",isInvalid:l,isValid:p,label:Object(i.translate)("onboarding.create_project.display_name"),required:!0},n.createElement("input",{className:S("input-super-large",{"is-invalid":l,"is-valid":p}),id:"project-name",maxLength:255,minLength:1,onChange:this.handleProjectNameChange,type:"text",value:a})),n.createElement(y.SubmitButton,{disabled:!this.canSubmit(this.state)||o},Object(i.translate)("set_up")),n.createElement(E.a,{className:"spacer-left",loading:o})))))}}a(1699);class Ke extends n.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={azureSettings:[],bitbucketSettings:[],githubSettings:[],gitlabSettings:[],loading:!0},this.fetchAlmBindings=()=>{this.setState({loading:!0}),Object(o.j)().then(e=>{this.mounted&&this.setState({azureSettings:e.filter(e=>e.alm===d.a.Azure),bitbucketSettings:e.filter(e=>e.alm===d.a.Bitbucket),githubSettings:e.filter(e=>e.alm===d.a.GitHub),gitlabSettings:e.filter(e=>e.alm===d.a.GitLab),loading:!1})}).catch(()=>{this.mounted&&this.setState({loading:!1})})},this.handleModeSelect=e=>{const{router:t,location:a}=this.props;t.push({pathname:a.pathname,query:{mode:e}})},this.handleProjectCreate=e=>{1===e.length&&this.props.router.push(Object(p.v)(e[0]))}}componentDidMount(){const{appState:{branchesEnabled:e}}=this.props;this.mounted=!0,e&&this.fetchAlmBindings()}componentWillUnmount(){this.mounted=!1}renderForm(e){const{appState:{canAdmin:t},location:a,router:r}=this.props,{azureSettings:i,bitbucketSettings:o,githubSettings:s,gitlabSettings:c,loading:l}=this.state;switch(e){case z.AzureDevOps:return n.createElement(ee,{canAdmin:!!t,loadingBindings:l,location:a,onProjectCreate:this.handleProjectCreate,router:r,settings:i});case z.BitbucketServer:return n.createElement(ue,{canAdmin:!!t,bitbucketSettings:o,loadingBindings:l,location:a,onProjectCreate:this.handleProjectCreate});case z.GitHub:return n.createElement(Pe,{canAdmin:!!t,loadingBindings:l,location:a,onProjectCreate:this.handleProjectCreate,router:r,settings:s});case z.GitLab:return n.createElement(Me,{canAdmin:!!t,loadingBindings:l,location:a,onProjectCreate:this.handleProjectCreate,router:r,settings:c});case z.Manual:return n.createElement(Be,{onProjectCreate:this.handleProjectCreate});default:{const e={[d.a.Azure]:i.length,[d.a.Bitbucket]:o.length,[d.a.GitHub]:s.length,[d.a.GitLab]:c.length};return n.createElement(ye,{almCounts:e,loadingBindings:l,onSelectMode:this.handleModeSelect})}}}render(){var e;const{appState:{branchesEnabled:t},location:a}=this.props,o=null===(e=a.query)||void 0===e?void 0:e.mode;return n.createElement(n.Fragment,null,n.createElement(r.a,{title:Object(i.translate)("my_account.create_new.TRK"),titleTemplate:"%s"}),n.createElement(s.a,{anchor:"create_project_main"}),n.createElement("div",{className:"page page-limited huge-spacer-bottom position-relative",id:"create-project"},this.renderForm(t?o:z.Manual)))}}t.default=Object(c.a)(Object(l.a)(Ke))},360:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(2),r=a(31),i=a(414);function o(e){return n.createElement(i.a.Consumer,null,({addA11ySkipLink:t,removeA11ySkipLink:a})=>n.createElement(s,Object.assign({addA11ySkipLink:t,removeA11ySkipLink:a},e)))}class s extends n.PureComponent{constructor(){super(...arguments),this.getLink=()=>{const{anchor:e,label:t=Object(r.translate)("skip_to_content"),weight:a}=this.props;return{key:e,label:t,weight:a}}}componentDidMount(){this.props.addA11ySkipLink(this.getLink())}componentWillUnmount(){this.props.removeA11ySkipLink(this.getLink())}render(){const{anchor:e}=this.props;return n.createElement("span",{id:"a11y_target__".concat(e)})}}},379:function(e,t,a){"use strict";var n,r;function i(e){return e.alm===n.Bitbucket}function o(e){return e.alm===n.GitHub}function s(e){return e.alm===n.GitLab}function c(e){return e.alm===n.Azure}function l(e){return void 0!==e&&void 0!==e.url&&void 0!==e.personalAccessToken}function p(e){return void 0!==e&&void 0!==e.appId&&void 0!==e.privateKey&&void 0!==e.url}a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r})),a.d(t,"f",(function(){return i})),a.d(t,"g",(function(){return o})),a.d(t,"h",(function(){return s})),a.d(t,"e",(function(){return c})),a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return p})),function(e){e.Azure="azure",e.Bitbucket="bitbucket",e.GitHub="github",e.GitLab="gitlab"}(n||(n={})),function(e){e[e.Validating=0]="Validating",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Warning=3]="Warning"}(r||(r={}))},511:function(e,t,a){"use strict";a.d(t,"h",(function(){return i})),a.d(t,"i",(function(){return o})),a.d(t,"j",(function(){return s})),a.d(t,"t",(function(){return c})),a.d(t,"d",(function(){return l})),a.d(t,"r",(function(){return p})),a.d(t,"b",(function(){return d})),a.d(t,"p",(function(){return m})),a.d(t,"c",(function(){return g})),a.d(t,"q",(function(){return u})),a.d(t,"e",(function(){return h})),a.d(t,"s",(function(){return b})),a.d(t,"f",(function(){return j})),a.d(t,"a",(function(){return y})),a.d(t,"k",(function(){return _})),a.d(t,"g",(function(){return f})),a.d(t,"l",(function(){return k})),a.d(t,"m",(function(){return E})),a.d(t,"n",(function(){return v})),a.d(t,"o",(function(){return S}));var n=a(9),r=a(323);function i(){return o().catch(r.a)}function o(){return Object(n.getJSON)("/api/alm_settings/list_definitions")}function s(e){return Object(n.getJSON)("/api/alm_settings/list",{project:e}).then(({almSettings:e})=>e).catch(r.a)}function c(e){return Object(n.get)("/api/alm_settings/validate",{key:e}).then(()=>"").catch(e=>e.status===n.HttpStatus.BadRequest?Object(n.parseError)(e):Object(r.a)(e))}function l(e){return Object(n.post)("/api/alm_settings/create_github",e).catch(r.a)}function p(e){return Object(n.post)("/api/alm_settings/update_github",e).catch(r.a)}function d(e){return Object(n.post)("/api/alm_settings/create_azure",e).catch(r.a)}function m(e){return Object(n.post)("/api/alm_settings/update_azure",e).catch(r.a)}function g(e){return Object(n.post)("/api/alm_settings/create_bitbucket",e).catch(r.a)}function u(e){return Object(n.post)("/api/alm_settings/update_bitbucket",e).catch(r.a)}function h(e){return Object(n.post)("/api/alm_settings/create_gitlab",e).catch(r.a)}function b(e){return Object(n.post)("/api/alm_settings/update_gitlab",e).catch(r.a)}function j(e){return Object(n.post)("/api/alm_settings/delete",{key:e}).catch(r.a)}function y(e){return Object(n.getJSON)("/api/alm_settings/count_binding",{almSetting:e}).then(({projects:e})=>e).catch(r.a)}function _(e){return Object(n.getJSON)("/api/alm_settings/get_binding",{project:e})}function f(e){return Object(n.post)("/api/alm_settings/delete_binding",{project:e}).catch(r.a)}function k(e){return Object(n.post)("/api/alm_settings/set_azure_binding",e).catch(r.a)}function E(e){return Object(n.post)("/api/alm_settings/set_bitbucket_binding",e).catch(r.a)}function v(e){return Object(n.post)("/api/alm_settings/set_github_binding",e).catch(r.a)}function S(e){return Object(n.post)("/api/alm_settings/set_gitlab_binding",e).catch(r.a)}},641:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return o})),a.d(t,"e",(function(){return s}));const n="almintegration",r="exclusions",i="languages",o="new_code_period",s="pull_request_decoration_binding"},721:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(2),r=a(35),i=a.n(r),o=a(347),s=a(534),c=a(465);function l(e){class t extends n.Component{componentDidMount(){Object(o.b)(this.props.currentUser)||i()()}render(){return Object(o.b)(this.props.currentUser)?n.createElement(e,Object.assign({},this.props)):null}}return t.displayName=Object(s.a)(e,"whenLoggedIn"),Object(c.a)(t)}},858:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(311),r=a(2),i=a(538),o=a.n(i),s=a(31),c=a(407);function l(e){const{error:t,help:a,label:i,placeholder:l,projectKey:p,touched:d,validating:m}=e,g=d&&void 0!==t,u=d&&!m&&void 0===t;return r.createElement(o.a,{className:"form-field",description:Object(s.translate)("onboarding.create_project.project_key.description"),error:t,help:a,id:"project-key",isInvalid:g,isValid:u,label:i,required:void 0!==i},r.createElement("input",{autoFocus:!0,className:n("input-super-large",{"is-invalid":g,"is-valid":u}),id:"project-key",maxLength:c.b,minLength:1,onChange:e.onProjectKeyChange,placeholder:l,type:"text",value:p}))}},859:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(335),r=a(407);function i(e){return 0===e.length?n.b.Empty:e.length>r.b?n.b.TooLong:/^[\w\-.:]*[a-z\-_.:]+[\w\-.:]*$/i.test(e)?n.b.Valid:/^[0-9]+$/.test(e)?n.b.OnlyDigits:n.b.InvalidChar}}}]);
//# sourceMappingURL=311.m.bfd0ee59.chunk.js.map